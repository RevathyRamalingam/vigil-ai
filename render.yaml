# Managed PostgreSQL Database
databases:
  - name: vigilai-db
    databaseName: vigilai_db
    user: vigilai
    plan: free

services:
  # Backend (FastAPI)
  - type: web
    name: vigilai-backend
    env: docker
    dockerContext: .
    dockerfilePath: ./backend/Dockerfile  # Changed from dockerfile
    plan: free
    healthCheckPath: /health
    envVars:
      - key: POSTGRES_HOST
        fromDatabase:
          name: vigilai-db
          property: host
      - key: POSTGRES_USER
        fromDatabase:
          name: vigilai-db
          property: user
      - key: POSTGRES_PASSWORD
        fromDatabase:
          name: vigilai-db
          property: password
      - key: POSTGRES_DB
        fromDatabase:
          name: vigilai-db
          property: database
      - key: REDIS_HOST
        fromService:
          name: vigilai-redis
          type: pserv
          property: host
      - key: REDIS_PORT
        value: "6379"
      - key: MINIO_ENDPOINT
        fromService:
          name: vigilai-minio
          type: pserv
          property: host
      - key: MINIO_PORT
        value: "9000"
      - key: USE_SQLITE
        value: "False"
      - key: DEBUG
        value: "False"

  # MinIO (Private Service)
  - type: pserv
    name: vigilai-minio
    env: docker
    dockerfilePath: ./Dockerfile.minio
    envVars:
      - key: MINIO_ROOT_USER
        generateValue: true
      - key: MINIO_ROOT_PASSWORD
        generateValue: true
    disk:
      name: minio-data
      mountPath: /data
      sizeGB: 1

  # Redis (Private Service)
  - type: pserv
    name: vigilai-redis
    env: docker
    dockerfilePath: ./Dockerfile.redis
    plan: free

  # Frontend (Vite + Nginx)
  - type: web
    name: vigilai-frontend
    env: docker
    dockerContext: .
    dockerfilePath: ./Dockerfile  # Changed from dockerfile
    plan: free
    envVars:
      - key: VITE_API_URL
        fromService:
          name: vigilai-backend
          type: web
          property: host